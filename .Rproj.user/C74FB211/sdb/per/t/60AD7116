{
    "contents" : "\n\n#### Draw smiles at day ###\n### test new commit\n\nrequire(dplyr)\nrequire(tidyr)\nrequire(ggplot2)\nsource(file = 'C:\\\\Users\\\\arhipov\\\\Documents\\\\RBackup\\\\.Structure\\\\deriv_vxsmile.R')\n\n# +------------------------------------+\n# | Prepare data\n# +------------------------------------+\n  \n  \n  all.data = read.csv(file = 'c:\\\\1\\\\data\\\\ri_smile.csv', sep = ';', header=T, dec=',')\n  all.data = all.data[-1]\n  all.data$tms = as.Date(substr(as.character(all.data$tms), 0, 10))\n  \n  dates.rng = c(min(all.data$tms), max(all.data$tms))\n  \n  \n# +------------------------------------+\n# | For each option series calc smile\n# | External variables used: all.data\n# +------------------------------------+\n\n  CalcSmilesSeries = function(strikeRng = 0.2, \n                              smileDate = as.Date('2010-09-06') ){\n    \n  ### Find coefs for intuted date\n    vx.at.date = all.data %>% filter(tms == smileDate)\n    \n  ### Make strikes range, include futures values\n    rng = strikeRng  \n    strikes = seq(min(vx.at.date$fut_price)*(1-rng), max(vx.at.date$fut_price)*(1+rng), length.out = 50 )\n    strikes = sort(c(strikes, vx.at.date$fut_price))\n    \n  ### Calc smile for every exp.date, strike value\n    smiles = lapply( c(1:nrow(vx.at.date)), function(x){\n      \n      x.row = x\n      sapply(strikes, function(x){\n        \n        strike = x\n        fut    = vx.at.date[x.row, 'fut_price', drop=T]\n        tdays  = vx.at.date[1, 't', drop=T] * 250\n        coef.vector = as.vector(vx.at.date[x.row, c('s', 'a', 'b', 'c', 'd', 'e')])\n        vxSmile(strike, fut, tdays, coef.vector)\n      })\n    })\n  \n  ### Arrange data for ggplot\n    names(smiles) = as.vector(vx.at.date$small_name)\n    smiles = gather(data = as.data.frame(c(list(strike = strikes), smiles)), key=strike )\n    names(smiles) = c('Strike', 'BaseFutures', 'IV')\n    \n    return(smiles)\n  }\n    \n\n\n\n\n\n\n",
    "created" : 1432300161816.000,
    "dirty" : false,
    "encoding" : "CP1251",
    "folds" : "",
    "hash" : "802333843",
    "id" : "60AD7116",
    "lastKnownWriteTime" : 1434467921,
    "path" : "~/RBackup/appSmile/history_manipulation.R",
    "project_path" : "history_manipulation.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}